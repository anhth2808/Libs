CREATE DATABASE QLPH
GO

USE QLPH
GO

CREATE TABLE GIANGDUONG
(
	MAGD VARCHAR(10) NOT NULL,
	TENGD NVARCHAR(100) NOT NULL,

CONSTRAINT PK_GIANGDUONG PRIMARY KEY(MAGD)
)
GO

CREATE TABLE PHONG 
(
	MAPHONG VARCHAR(10) NOT NULL,
	SUCCHUA INTEGER NOT NULL,
	MAGD VARCHAR(10) NULL,
	
	CONSTRAINT PK_PHONGHOC PRIMARY KEY(MAPHONG)		
)
GO

CREATE TABLE TRANGTHIETBI
(
	MATTB VARCHAR(10) NOT NULL,
	TENTTB NVARCHAR(100) NOT NULL,
	
	CONSTRAINT PK_TRANGTHIETBI PRIMARY KEY(MATTB)
)
GO

CREATE TABLE PHONG_TRANGTHIETBI
(
	MATTB VARCHAR(10) NOT NULL,
	MAPHONG VARCHAR(10) NOT NULL,
	SOLUONG INTEGER NOT NULL,	
	
	CONSTRAINT PK_PHONG_TRANGTHIETBI PRIMARY KEY(MATTB, MAPHONG)	
)
GO

CREATE TABLE SINHVIEN
(
	MASV VARCHAR(10) NOT NULL,
	HO NVARCHAR(50) NOT NULL,
	TEN NVARCHAR(50) NOT NULL,
	GIOITINH NVARCHAR(10) NOT NULL,

	CONSTRAINT PK_SINHVIEN PRIMARY KEY(MASV)	
)
GO

CREATE TABLE GIANGVIEN
(
	MAGV VARCHAR(10) NOT NULL,
	HO NVARCHAR(50) NOT NULL,
	TEN NVARCHAR(50) NOT NULL,
	DIENTHOAI VARCHAR(20) NULL,	
	GIOITINH NVARCHAR(10) NOT NULL,
		
	CONSTRAINT PK_GIANGVIEN PRIMARY KEY(MAGV)
)
GO

CREATE TABLE TIETHOC
(
	MATH VARCHAR(10) NOT NULL,	
	
	CONSTRAINT PK_TIETHOC PRIMARY KEY(MATH)
)
GO

CREATE TABLE MONHOC
(
	MAMH VARCHAR(10) NOT NULL,
	TENMH NVARCHAR(100) NOT NULL,
	SOTINCHI INTEGER NOT NULL,	
	
	CONSTRAINT PK_MONHOC PRIMARY KEY(MAMH)
)
GO

CREATE TABLE NHOMHOCPHAN
(
	MANHP VARCHAR(10) NOT NULL,	
	NGAYBATDAU DATE NOT NULL,
	NGAYKETTHUC DATE NOT NULL,
	MAMH VARCHAR(10) NOT NULL,
	MAGV VARCHAR(10) NOT NULL,
	
	CONSTRAINT PK_NHOMHOCPHAN PRIMARY KEY(MANHP)
)
GO

CREATE TABLE SINHVIEN_NHOMHOCPHAN
(
	MASV VARCHAR(10) NOT NULL,	
	MANHP VARCHAR(10) NOT NULL,
		
	CONSTRAINT PK_SINHVIEN_NHOMHOCPHAN PRIMARY KEY(MASV, MANHP)
)
GO

CREATE TABLE TUAN
(
	SOTUAN INTEGER NOT NULL IDENTITY(1,1),

	CONSTRAINT PK_TUAN PRIMARY KEY(SOTUAN)
)
GO

CREATE TABLE THOIKHOABIEU
(
	MANHP VARCHAR(10) NOT NULL,
	THU VARCHAR(50) NOT NULL,	
	MAPHONG VARCHAR(10) NOT NULL,
	MATH VARCHAR(10) NOT NULL,
	SOTUAN INTEGER NOT NULL IDENTITY(1,1),
	CONSTRAINT PK_THOIKHOABIEU PRIMARY KEY(THU)
)
GO


/* PHONG */
ALTER TABLE dbo.PHONG
ADD CONSTRAINT FK1_GIANGDUONG FOREIGN KEY(MAGD) REFERENCES dbo.GIANGDUONG(MAGD)

/* PHONG_TRANGTHIETBI */
ALTER TABLE dbo.PHONG_TRANGTHIETBI
ADD CONSTRAINT FK1_PHONG FOREIGN KEY(MAPHONG) REFERENCES dbo.PHONG(MAPHONG)
ALTER TABLE dbo.PHONG_TRANGTHIETBI
ADD CONSTRAINT FK2_TRANGTHIETBI FOREIGN KEY(MATTB) REFERENCES dbo.TRANGTHIETBI(MATTB)

/* NHOMHOCPHAN */
ALTER TABLE dbo.NHOMHOCPHAN
ADD CONSTRAINT FK1_GIANGVIEN FOREIGN KEY(MAGV) REFERENCES dbo.GIANGVIEN(MAGV)
ALTER TABLE dbo.NHOMHOCPHAN
ADD CONSTRAINT FK2_MONHOC FOREIGN KEY(MAMH) REFERENCES dbo.MONHOC(MAMH)

/* SINHVIEN_NHOMHOCPHAN */
ALTER TABLE dbo.SINHVIEN_NHOMHOCPHAN
ADD CONSTRAINT FK1_SINHVIEN FOREIGN KEY(MASV) REFERENCES dbo.SINHVIEN(MASV)
ALTER TABLE dbo.SINHVIEN_NHOMHOCPHAN
ADD CONSTRAINT FK2_NHOMHOCPHAN FOREIGN KEY(MANHP) REFERENCES dbo.NHOMHOCPHAN(MANHP)

/* THOIKHOABIEU */
ALTER TABLE dbo.THOIKHOABIEU
ADD CONSTRAINT FK1_NHOMHOCPHAN FOREIGN KEY(MANHP) REFERENCES dbo.NHOMHOCPHAN(MANHP)
ALTER TABLE dbo.THOIKHOABIEU
ADD CONSTRAINT FK2_PHONG FOREIGN KEY(MAPHONG) REFERENCES dbo.PHONG(MAPHONG)
ALTER TABLE dbo.THOIKHOABIEU
ADD CONSTRAINT FK3_TIETHOC FOREIGN KEY(MATH) REFERENCES dbo.TIETHOC(MATH)
ALTER TABLE dbo.THOIKHOABIEU
ADD CONSTRAINT FK4_TUAN FOREIGN KEY(SOTUAN) REFERENCES dbo.TUAN(SOTUAN)
GO

/*----------------------------------------------------------------------*/
INSERT INTO dbo.GIANGDUONG
( MAGD, TENGD )
VALUES
(  'G1' , N'GIANG DUONG G1' ),
(  'G2' , N'GIANG DUONG G2' ),
(  'G3' , N'GIANG DUONG G3' ),
(  'G4' , N'GIANG DUONG G4' ),
(  'G5' , N'GIANG DUONG G5' ),
(  'G6' , N'GIANG DUONG G6' ),
(  'G7' , N'GIANG DUONG G7' ),
(  'G8' , N'GIANG DUONG G8' )

INSERT INTO dbo.GIANGVIEN
( MAGV , HO , TEN , DIENTHOAI , GIOITINH )
VALUES
( '7547' , N'Trần' , N'Dần' , '034865564', N'Nam' ),
( '5357' , N'Nguyễn' , N'B' , '02537547', N'Nam' ),
( '2345' , N'Đào' , N'C' , '023854548', N'Nam' ),
( '7533' , N'Huỳnh' , N'D' , '08897345', N'Nam' ),
( '3458' , N'Lê' , N'E' , '0999999', N'Nam' ),
( '4537' , N'Lương' , N'V' , '0119999', N'Nữ' ),
( '7453' , N'Cao' , N'N' , '035763427', N'Nữ' ),
( '5344' , N'Chu' , N'Y' , '0724456666', N'Nữ' ),
( '4539' , N'Ông' , N'Hai Dụ' , '034997766', N'Nữ' ),
( '4867' , N'Tạ' , N'E' , '023587777', N'Nữ' ),
( '6453' , N'Trương' , N'U' , '09866666', N'Nữ' )

INSERT INTO dbo.MONHOC
( MAMH , TENMH , SOTINCHI )
VALUES
( 'INS335' ,  N'Thống kê máy tính' , 3 ),
( 'INS339' ,  N'Hệ quản trị cơ sở dữ liệu' , 3 ),
( 'INS360' ,  N'Phân tích thiết kế hệ thống thông tin' , 3 ),
( 'NEC337' ,  N'Quản trị mạng' , 3 ),
( 'POL333' ,  N'Tư tưởng Hồ Chí Minh	' , 2 ),
( 'INS337' ,  N'Lập trình thiết bị nhúng' , 3 ),
( 'FOT344' ,  N'Thiết bị chế biến thực phẩm' , 3 ),
( 'FOT351' ,  N'Tin học ứng dụng trong công nghệ thực phẩm' , 3 ),
( 'FOT364' ,  N'Công nghệ đồ hộp thực phẩm' , 3 ),
( 'SPT365' ,  N'Công nghệ lạnh và lạnh đông thực phẩm	' , 3 ),
( 'ACC325' ,  N'Nguyên lý kế toán' , 3 ),
( 'BUA346' ,  N'Quản trị nguồn nhân lực' , 3 ),
( 'BIO375' ,  N'Công nghệ vi sinh vật' , 3 ),
( 'BIO379' ,  N'Sinh lý học thực vật' , 3 ),
( 'POL318' ,  N'Những NL CB của CN Mác-Lênin 2' , 2 ),
( 'BIO3010' ,  N'Công nghệ gen' , 2 )

INSERT INTO dbo.NHOMHOCPHAN
( MANHP , NGAYBATDAU , NGAYKETTHUC , MAMH , MAGV )
VALUES
( '01', '09/02/2019' , '12/23/2019' , 'POL333', '7547' ),
( '02', '09/02/2019' , '12/23/2019' , 'POL333', '7547' ),
( '03', '09/02/2019' , '12/23/2019' , 'POL333', '7547' ),
( '04', '09/02/2019' , '12/23/2019' , 'POL333', '7547' ),
( '05', '09/02/2019' , '12/23/2019' , 'POL333', '4539' ),
( '06', '09/02/2019' , '12/23/2019' , 'POL333', '4539' ),
( '07', '09/02/2019' , '12/23/2019' , 'POL333', '4539' ),
( '08', '09/02/2019' , '12/23/2019' , 'POL333', '4539' ),
( '09', '09/02/2019' , '12/23/2019' , 'POL333', '4539' ),
( '10', '09/02/2019' , '12/23/2019' , 'POL333', '4539' )

INSERT INTO dbo.PHONG
( MAPHONG , SUCCHUA , MAGD )
VALUES
( '101' , 50 , 'G1' ),
( '102' , 50 , 'G1' ),
( '103' , 50 , 'G1' ),
( '104' , 50 , 'G1' ),
( '105' , 50 , 'G1' ),
( '201' , 60 , 'G1' ),
( '202' , 70 , 'G1' ),
( '203' , 60 , 'G1' ),
( '204' , 70 , 'G1' ),
( '205' , 60 , 'G1' ),
( '301' , 40 , 'G1' ),
( '302' , 40 , 'G1' ),
( '303' , 40 , 'G1' ),
( '304' , 50 , 'G1' ),
( '305' , 40 , 'G1' )

INSERT INTO dbo.TRANGTHIETBI
( MATTB , TENTTB )
VALUES
( 'MTB', N'MAY TINH BAN DELL' ),
( 'MC' , N'MAY CHIEU' ),
( 'MF' , N'MAY FAX' ),
( 'MI' , N'MAY IN' )

INSERT INTO dbo.PHONG_TRANGTHIETBI
( MAPHONG , MATTB , SOLUONG )
VALUES
( '101' , 'MTB' , 10 ),
( '102' , 'MTB' , 10 ),
( '103' , 'MTB' , 10 ),
( '105' , 'MTB' , 10 ),
( '101' , 'MC' , 1 ),
( '102' , 'MC' , 1 ),
( '103' , 'MC' , 1 ),
( '105' , 'MC' , 1 ),
( '101' , 'MI' , 1 ),
( '103' , 'MI' , 1 ),
( '104' , 'MI' , 1 )

INSERT INTO dbo.SINHVIEN
( MASV , HO , TEN , GIOITINH )
VALUES
( '001', N'Trần' , N'R' , N'Nam' ),
( '002', N'Huỳnh' , N'T' , N'Nam' ),
( '003', N'Trần' , N'A' , N'Nữ' ),
( '004', N'Lương' , N'S' , N'Nữ' ),
( '005', N'Huỳnh' , N'G' , N'Nam' ),
( '006', N'Huỳnh' , N'H' , N'Nữ' ),
( '007', N'Trần' , N'D' , N'Nam' ),
( '008', N'Tạ' , N'H' , N'Nữ' ),
( '009', N'Tạ' , N'D' , N'Nam' ),
( '010', N'Trương' , N'C' , N'Nữ' ),
( '011', N'Trương' , N'X' , N'Nam' ),
( '012', N'Lê' , N'Z' , N'Nữ' ),
( '013', N'Lê' , N'J' , N'Nam' ),
( '014', N'Lê' , N'D' , N'Nữ' ),
( '015', N'Lê' , N'H' , N'Nữ' )

INSERT INTO dbo.SINHVIEN_NHOMHOCPHAN
( MASV , MANHP )
VALUES
( '001' , '01' ),
( '002' , '07' ),
( '003' , '01' ),
( '004' , '01' ),
( '005' , '07' ),
( '006' , '01' ),
( '007' , '01' ),
( '008' , '07' ),
( '009' , '07' ),
( '010' , '01' ),
( '011' , '01' ),
( '012' , '07' ),
( '013' , '07' ),
( '014' , '10' ),
( '015' , '10' )

INSERT INTO dbo.TIETHOC
( MATH )
VALUES
( '1' ),
( '2' ),
( '3' ),
( '4' ),
( '5' ),
( '6' ),
( '7' ),
( '8' ),
( '9' ),
( '10' ),
( '11' ),
( '12' ),
( '13' )
GO
--E Truy vấn không/chưa có--
--1 Tên sinh viên không học nhóm hoc phần 10--
SELECT HO,TEN FROM dbo.SINHVIEN JOIN dbo.SINHVIEN_NHOMHOCPHAN ON SINHVIEN_NHOMHOCPHAN.MASV = SINHVIEN.MASV
WHERE NOT MANHP='10'
GO
--2 Những sinh viên có họ Trần, Huỳnh, Lê
SELECT * FROM dbo.SINHVIEN
WHERE HO IN('Trần','Huỳnh','Lê');
GO
--3 Những giang viên có tên không bắt đầu bằng chữ E--
SELECT * FROM dbo.GIANGVIEN
WHERE TEN NOT LIKE 'E%';
--4 MASV không học môn BIO3010--
SELECT MASV FROM dbo.SINHVIEN_NHOMHOCPHAN JOIN dbo.NHOMHOCPHAN ON NHOMHOCPHAN.MANHP = SINHVIEN_NHOMHOCPHAN.MANHP
JOIN dbo.MONHOC ON MONHOC.MAMH = NHOMHOCPHAN.MAMH
WHERE NOT MONHOC.MAMH='BIO3010'
GO
--5 Hiển thị trang thiết bị mỗi phòng--
SELECT MAGD,PHONG.MAPHONG, MATTB,SOLUONG FROM dbo.PHONG LEFT JOIN dbo.PHONG_TRANGTHIETBI ON PHONG_TRANGTHIETBI.MAPHONG = PHONG.MAPHONG
--6 Những môn học có 3 tín chỉ--
SELECT * FROM dbo.MONHOC
WHERE SOTINCHI NOT IN(2,4);
GO
--7 Ngày bắt đầu và kết thúc của mỗi môn học--
SELECT NGAYBATDAU,NGAYKETTHUC,M.MAMH as Ma,TENMH FROM dbo.NHOMHOCPHAN NH 
RIGHT JOIN dbo.MONHOC M ON NH.MAMH = M.MAMH

--F Truy vấn Hợp, Giao, Trừ--
--1 Hiện thông tin sinh viên và giảng viên có giới tính nữ--
SELECT HO,TEN, MASV FROM dbo.SINHVIEN 
WHERE dbo.SINHVIEN.GIOITINH=N'Nữ'
UNION
SELECT HO,TEN,MAGV FROM dbo.GIANGVIEN 
WHERE dbo.GIANGVIEN.GIOITINH=N'Nữ' 
ORDER BY 3
GO
--2 hiển thị sinh viên và giang viên có họ trùng nhau trong nhóm học phần 07--
SELECT HO FROM dbo.SINHVIEN 
JOIN dbo.SINHVIEN_NHOMHOCPHAN ON SINHVIEN_NHOMHOCPHAN.MASV = SINHVIEN.MASV
WHERE MANHP='07'
INTERSECT
SELECT HO  FROM dbo.GIANGVIEN 
JOIN dbo.NHOMHOCPHAN ON NHOMHOCPHAN.MAGV = GIANGVIEN.MAGV 
WHERE MANHP='07'
 
 --3 Chọn những môn học không bắt đầu từ tháng 9
 SELECT MAMH FROM dbo.MONHOC
 EXCEPT 
 SELECT MAMH FROM dbo.NHOMHOCPHAN
 WHERE MONTH(NGAYBATDAU)=09
  

--G Truy vấn update,delect--
--1 Xóa thông tin giảng đường G8--
DELETE FROM GIANGDUONG 
WHERE MAGD='G8';
GO
--2 Xóa thông tin những phòng có sức chứa nhỏ hỏn 50--
DELETE FROM dbo.PHONG
WHERE SUCCHUA<50; 
GO
--3 Xóa những 
DELETE FROM dbo.SINHVIEN_NHOMHOCPHAN 
WHERE EXISTS
(SELECT *
FROM dbo.NHOMHOCPHAN
WHERE dbo.NHOMHOCPHAN.MANHP = dbo.SINHVIEN_NHOMHOCPHAN.MANHP
 AND dbo.NHOMHOCPHAN.MAGV ='7547');
GO
--4 Xóa máy tính bàn ở phòng 101
DELETE FROM dbo.PHONG_TRANGTHIETBI
WHERE MATTB='MTB' AND MAPHONG='101';
GO
--5 Cập nhập sô lượng máy in--
UPDATE dbo.PHONG_TRANGTHIETBI SET SOLUONG=5 WHERE MATTB='MI';
GO
--6 Cập nhập mã sinh viên 001 thành 016--
UPDATE dbo.SINHVIEN SET MASV='016' WHERE MASV='001';
GO
--7 Cập nhập máy tính dell thanh hp
UPDATE dbo.TRANGTHIETBI SET TENTTB='Máy tính bàn HP' WHERE MATTB='MTB'
Go